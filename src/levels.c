#include "../include/levels.h"

const level_t levels[] = {
    {
        .tiles = level1_tiles,
        .tiles_bank = BANK(level1_tiles),
        .collisions = level1_collisions,
        .collisions_bank = BANK(level1_collisions),
        .tile_width = level1_tile_width,
        .tile_height = level1_tile_height,
        .spawn_x = level1_spawn_x,
        .spawn_y = level1_spawn_y,
        .door_open = level1_door_open,
    },
    {
        .tiles = level2_tiles,
        .tiles_bank = BANK(level2_tiles),
        .collisions = level2_collisions,
        .collisions_bank = BANK(level2_collisions),
        .tile_width = level2_tile_width,
        .tile_height = level2_tile_height,
        .spawn_x = level2_spawn_x,
        .spawn_y = level2_spawn_y,
        .door_open = level2_door_open,
    },
    {
        .tiles = level3_tiles,
        .tiles_bank = BANK(level3_tiles),
        .collisions = level3_collisions,
        .collisions_bank = BANK(level3_collisions),
        .tile_width = level3_tile_width,
        .tile_height = level3_tile_height,
        .spawn_x = level3_spawn_x,
        .spawn_y = level3_spawn_y,
        .door_open = level3_door_open,
    },
    {
        .tiles = level4_tiles,
        .tiles_bank = BANK(level4_tiles),
        .collisions = level4_collisions,
        .collisions_bank = BANK(level4_collisions),
        .tile_width = level4_tile_width,
        .tile_height = level4_tile_height,
        .spawn_x = level4_spawn_x,
        .spawn_y = level4_spawn_y,
        .door_open = level4_door_open,
    },
    {
        .tiles = level5_tiles,
        .tiles_bank = BANK(level5_tiles),
        .collisions = level5_collisions,
        .collisions_bank = BANK(level5_collisions),
        .tile_width = level5_tile_width,
        .tile_height = level5_tile_height,
        .spawn_x = level5_spawn_x,
        .spawn_y = level5_spawn_y,
        .door_open = level5_door_open,
    },
    {
        .tiles = level6_tiles,
        .tiles_bank = BANK(level6_tiles),
        .collisions = level6_collisions,
        .collisions_bank = BANK(level6_collisions),
        .tile_width = level6_tile_width,
        .tile_height = level6_tile_height,
        .spawn_x = level6_spawn_x,
        .spawn_y = level6_spawn_y,
        .door_open = level6_door_open,
    },
    {
        .tiles = level7_tiles,
        .tiles_bank = BANK(level7_tiles),
        .collisions = level7_collisions,
        .collisions_bank = BANK(level7_collisions),
        .tile_width = level7_tile_width,
        .tile_height = level7_tile_height,
        .spawn_x = level7_spawn_x,
        .spawn_y = level7_spawn_y,
        .door_open = level7_door_open,
    },
    {
        .tiles = level8_tiles,
        .tiles_bank = BANK(level8_tiles),
        .collisions = level8_collisions,
        .collisions_bank = BANK(level8_collisions),
        .tile_width = level8_tile_width,
        .tile_height = level8_tile_height,
        .spawn_x = level8_spawn_x,
        .spawn_y = level8_spawn_y,
        .door_open = level8_door_open,
    },
    {
        .tiles = level9_tiles,
        .tiles_bank = BANK(level9_tiles),
        .collisions = level9_collisions,
        .collisions_bank = BANK(level9_collisions),
        .tile_width = level9_tile_width,
        .tile_height = level9_tile_height,
        .spawn_x = level9_spawn_x,
        .spawn_y = level9_spawn_y,
        .door_open = level9_door_open,
    },
    {
        .tiles = level10_tiles,
        .tiles_bank = BANK(level10_tiles),
        .collisions = level10_collisions,
        .collisions_bank = BANK(level10_collisions),
        .tile_width = level10_tile_width,
        .tile_height = level10_tile_height,
        .spawn_x = level10_spawn_x,
        .spawn_y = level10_spawn_y,
        .door_open = level10_door_open,
    },
    {
        .tiles = level11_tiles,
        .tiles_bank = BANK(level11_tiles),
        .collisions = level11_collisions,
        .collisions_bank = BANK(level11_collisions),
        .tile_width = level11_tile_width,
        .tile_height = level11_tile_height,
        .spawn_x = level11_spawn_x,
        .spawn_y = level11_spawn_y,
        .door_open = level11_door_open,
    },
    {
        .tiles = level12_tiles,
        .tiles_bank = BANK(level12_tiles),
        .collisions = level12_collisions,
        .collisions_bank = BANK(level12_collisions),
        .tile_width = level12_tile_width,
        .tile_height = level12_tile_height,
        .spawn_x = level12_spawn_x,
        .spawn_y = level12_spawn_y,
        .door_open = level12_door_open,
    },
    {
        .tiles = level13_tiles,
        .tiles_bank = BANK(level13_tiles),
        .collisions = level13_collisions,
        .collisions_bank = BANK(level13_collisions),
        .tile_width = level13_tile_width,
        .tile_height = level13_tile_height,
        .spawn_x = level13_spawn_x,
        .spawn_y = level13_spawn_y,
        .door_open = level13_door_open,
    },
    {
        .tiles = level14_tiles,
        .tiles_bank = BANK(level14_tiles),
        .collisions = level14_collisions,
        .collisions_bank = BANK(level14_collisions),
        .tile_width = level14_tile_width,
        .tile_height = level14_tile_height,
        .spawn_x = level14_spawn_x,
        .spawn_y = level14_spawn_y,
        .door_open = level14_door_open,
    },
    {
        .tiles = level15_tiles,
        .tiles_bank = BANK(level15_tiles),
        .collisions = level15_collisions,
        .collisions_bank = BANK(level15_collisions),
        .tile_width = level15_tile_width,
        .tile_height = level15_tile_height,
        .spawn_x = level15_spawn_x,
        .spawn_y = level15_spawn_y,
        .door_open = level15_door_open,
    },
    {
        .tiles = level16_tiles,
        .tiles_bank = BANK(level16_tiles),
        .collisions = level16_collisions,
        .collisions_bank = BANK(level16_collisions),
        .tile_width = level16_tile_width,
        .tile_height = level16_tile_height,
        .spawn_x = level16_spawn_x,
        .spawn_y = level16_spawn_y,
        .door_open = level16_door_open,
    },
};

void init_title(void)
{
    uint8_t currentBank = CURRENT_BANK;

    SWITCH_ROM(BANK(title));
    set_bkg_data(0, title_TILE_COUNT, title_tiles);
    SWITCH_ROM(BANK(title_screen_tiles));
    set_bkg_submap(0, 0, 20, 18, title_screen_tiles, title_screen_tile_width);

    SWITCH_ROM(currentBank);
}

void init_end_screen(void)
{
    uint8_t currentBank = CURRENT_BANK;

    SWITCH_ROM(BANK(end));
    set_bkg_data(0, end_TILE_COUNT, end_tiles);
    SWITCH_ROM(BANK(end_screen_tiles));
    set_bkg_submap(0, 0, 20, 18, end_screen_tiles, end_screen_tile_width);

    SWITCH_ROM(currentBank);
}

void init_level(uint8_t level) NONBANKED
{
    uint8_t initSprites = (gfx.sprites_inited == 0);
    if (level > 0 && level <= NUM_LEVELS)
    {
        game.level_data = levels[level - 1];
        game.flags &= ~(GF_DOOR_OPEN | GF_ITEM_PICKED);
        game.levelFrame = 0;
        if (game.level_data.door_open == 1)
        {
            game.flags |= GF_DOOR_OPEN;
        }

        init_player(initSprites, game.level_data.spawn_x, game.level_data.spawn_y);
        camera.targetX = 0;
        camera.targetY = 0;
        set_camera_target();
        update_camera_coordinates();

        uint8_t currentBank = CURRENT_BANK;

        SWITCH_ROM(BANK(caverns));
        set_bkg_data(0, caverns_TILE_COUNT, caverns_tiles);

        SWITCH_ROM(BANK(font_bold));
#if defined(NINTENDO)
        set_win_data(caverns_TILE_COUNT, font_bold_TILE_COUNT, font_bold_tiles);
#endif

        SWITCH_ROM(game.level_data.tiles_bank);
        set_bkg_submap((uint8_t)(camera.x >> 3u), (uint8_t)(camera.y >> 3u), 21, 19, game.level_data.tiles, game.level_data.tile_width);

        SWITCH_ROM(currentBank);

        init_key(initSprites);
        init_atl(initSprites);
        gfx.sprites_inited = 1;
    }
}
